{% extends "base.html" %}
{% load dict_extras %}


{% block title %}Timetable List{% endblock %}

{% block extra_css %}
  <style>
    /* Basic styling for the timetable grid */
    .table td, .table th {
      text-align: center;
      padding: 10px;
    }
    .table th {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    .table td {
      border: 1px solid #dee2e6;
    }
    .time-slot-header {
      background-color: #f0f8ff;
      font-weight: bold;
    }
    .day-column {
      background-color: #f0f8ff;
      font-weight: bold;
    }
    .subject-teacher {
      display: block;
      margin-bottom: 5px;
    }
    .no-entry {
      color: gray;
    }
  </style>
{% endblock %}

{% block content %}
  <h2 class="text-center text-primary mb-4">Timetable List</h2>

  <!-- Add Timetable Button -->
  <div class="form-container mb-3">
    <a href="{% url 'timetable_create' %}" class="btn btn-primary">
      <i class="fas fa-plus-circle"></i> Add Timetable Entry
    </a>
  </div>

  <!-- Timetable Grid -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th class="time-slot-header">Time Slot</th>
          {% for day in days %}
            <th class="day-column">{{ day }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for ts in timeslots %}
          <tr>
            <td>{{ ts.start_time|time:"h:i A" }} - {{ ts.end_time|time:"h:i A" }}</td>
            {% for day in days %}
              <td>
                {% with timetable_entry=timetables|get_item:day %}
                  {% with cell=timetable_entry|get_item:ts.id %}
                    {% if cell %}
                      <span class="subject-teacher">
                        <strong>{{ cell.subject.name }}</strong>
                      </span>
                      <span class="subject-teacher">
                        <small>{{ cell.teacher.name }}</small>
                      </span>
                    {% else %}
                      <span class="no-entry">--</span>
                    {% endif %}
                  {% endwith %}
                {% endwith %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>


{% endblock %}

{% block extra_js %}
  <script>
    // Auto-hide alert messages after 3 seconds.
    document.addEventListener("DOMContentLoaded", function() {
      setTimeout(function() {
        document.querySelectorAll('.alert').forEach(function(alert) {
          alert.style.transition = 'opacity 0.5s ease';
          alert.style.opacity = '0';
          setTimeout(function() {
            alert.remove();
          }, 500);
        });
      }, 3000);
    });
  </script>
{% endblock %}
